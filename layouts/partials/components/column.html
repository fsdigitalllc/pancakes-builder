{{/* <!--start columns--> */}}
{{ $scratch := .global.global.global.Scratch }}
{{ $global_scratch := .global.global.global.Scratch }}
{{ $global_site := .global.global.global.Scratch.Get "site" }}
{{ $cloud_base := $global_scratch.Get "cloudinary_base"}}
{{ $cloud_folder_name := $global_scratch.Get "cloudinary_folder" }}
{{ $cloud_folder := $cloud_folder_name }}
{{ $cloud_name  := $global_scratch.Get "cloudinary_name" }}

{{ $css := $global_scratch.Get "is_css"}}

{{ if $cloud_folder_name }}
  {{ $cloud_folder = print $cloud_folder_name "/" }}
{{ end }}

<div data-column-size="col-{{ .size | default "6" }}"{{ with .background_color }} style="background-color: {{ . }}"{{ end }} class="flex-container flex-item column col-{{ .size | default "6" }} v_content_ h_content_ col_bg" >

<div{{ if .animate }} data-aos="{{ .page.animate }}" data-aos-offset="data_aos_offset" data-aos-anchor="#section_id" {{ end }} style="" class="elements-wrapper {{ with .page.content_width }} maxwidth-{{ . | lower }}{{ end }}{{ with .page.p_top }} padding-{{ . | lower }}-top{{ end }}{{ with .page.p_bottom }} padding-{{ . | lower }}-bottom{{ end }}{{ with .page.text_align }} text-align-children-{{ . }}{{ end }}">

{{ range $index, $elements := .page.elements }}

{{/* <!--individual elements--> */}}

  {{ if in .template "element-image" }}
  {{ $img_quality := .quality | default "100" }}
  {{ $img_quality = print $img_quality "/" }}
  {{ $img_size := print "w_1000,c_limit/"}}

  {{ $alt_text := .alt }}
  {{ with .alt }}
    {{ $alt_text = . }}
  {{ else }}
  {{ $alt_text = replaceRE "\\..+" "" .image }}
    {{ $alt_text = $alt_text }}
  {{ end }}

    {{ with .image }}
      {{ $img_src := . }}
      {{ if in . "http" }}
      {{/* <!--if absolute link, not cloudinary--> */}}
        {{ $img_src = . }}
        <img
        srcset="
        {{ . }} 500w,
          {{ . }} 768w,
          {{ . }} 2x"
        src="{{ . }}" alt="{{ $alt_text }}"/>
      {{ else if in . "uploads" }}
      {{/* <!--if resource upload in content/uploads, perform basic image processing--> */}}
      {{/* <!--need to make these options manual--> */}}
          {{ $imageResource := ($global_site.GetPage "section" "uploads").Resources.GetMatch (strings.TrimPrefix "/uploads/" . ) }}
          
          {{ $resized900 := ($imageResource.Resize "900x q100") }}
          {{ $resized500 := ($imageResource.Resize "500x q100") }}
          <img 
          data-sizes="(min-width: 1000px) 900px, 90vw" data-srcset="{{ $resized500.RelPermalink }} 500w, {{ $resized900.RelPermalink }} 900w" data-src="{{ $resized500.RelPermalink }}" class="lazyload" alt="{{ $alt_text }}"/>
      {{/* <!-- <img
      src="{{ $img_src }}"
      data-src="{{ $img_src }}/{width}"
      data-sizes="auto"
      class="lazyload"
      alt="" /> --> */}}
      {{ else if $cloud_base }}
      {{/* <!--if cloudinary, process image by changing the URL structure. Keep in mind bandwidth limit--> */}}
      {{/* <!--combined this with lazysizes and lazysizes auto sizing plugin--> */}}
      {{ $img_src = print $cloud_base "q_" $img_quality "c_scale,w_auto/" $cloud_folder . }}
      {{ $img_src_desktop := print $cloud_base "q_" $img_quality "c_scale,w_1920/" $cloud_folder . }}
      {{ $img_src_tablet := print $cloud_base "q_" $img_quality "c_scale,w_768/" $cloud_folder . }}
      {{ $img_src_mobile := print $cloud_base "q_" $img_quality "c_scale,w_500/" $cloud_folder . }}
      {{/* <!-- <img
        data-size="auto" data-src="{{ $img_src }}" data-srcset="{{ $img_src_mobile }} 520w, {{ $img_src_tablet }} 900w, {{ $img_src_desktop }} 1080w" class="cld-responsive" alt="{{ $alt_text }}" /> --> */}}
        {{/* <!-- <img data-src="{{ $img_src }}" data-srcset="{{ $img_src_mobile }} 520w, {{ $img_src_tablet }} 900w, {{ $img_src_desktop }} 1080w" class="cld-responsive" alt="{{ $alt_text }}" /> --> */}}
        <img
          src=""
          data-src="{{ $cloud_base }}q_auto,f_auto,w_{width}/{{ $cloud_folder }}{{ . }}"
          data-sizes="auto"
          class="lazyload"
          alt="" />
        {{/* <!--enable the cloudinary scripts--> */}}
        {{ $global_scratch.Set "cld_responsive" true }}
      
      {{ end }}
      
    {{ else }}{{/* <!--withelse--> */}}
    no image found
    {{ end }}{{/* <!--endwith--> */}}

  {{ end }}{{/* <!--end if image--> */}}

  {{ if in .template "element-title" }}
  {{ with .tag }}{{ print "<" . ">" | safeHTML }}{{ else }}{{ print "<h2>" | safeHTML }}{{ end }}
    {{ .title }}
  {{ with .tag }}{{ print "</" . ">" | safeHTML }}{{ else }}{{ print "</h2>" | safeHTML }}{{ end }}
  {{ end }}

{{/* <!--end individual elements--> */}}


{{ end }}{{/* <!--end elements range--> */}}

</div>{{/* <!--end element wrapper--> */}}

</div>{{/* <!--end column--> */}}