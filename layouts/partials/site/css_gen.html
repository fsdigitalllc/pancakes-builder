{{- $env := getenv "HUGO_ENV" -}}

{{ $this_uniqueid := .page.UniqueID | urlize }}


{{ range $index, $stacks := .page.Site.Pages }}

  {{- $title := .Title -}}
  {{- $page_uniqueid:= .UniqueID | urlize -}}
  {{- $clean_slug := replace .Params.slug "/" "" -}}
  {{- $page_slug := $clean_slug -}}
  


{{ if .Params.stacks }}


  {{- range $index, $stacks := (where .Params.stacks ".template" "!=" "custom-header") -}}

  
  {{- $.page.Scratch.Set "section_index" $index -}}
  {{- $.page.Scratch.Set "section_template_name" .template -}}
  {{- $section_class := print "c-" $index "-" .template -}}
  {{- $.page.Scratch.Set "section_class" $section_class -}}
  {{- $.page.Scratch.Set "page_uniqueid" $page_uniqueid -}}
  
  {{ if eq ($.page.Scratch.Get "is_critical") true }}
  
  
    {{ $.page.Scratch.Set "style_index" (and (eq $this_uniqueid $page_uniqueid) (le $index 1)) }}
  {{ else }}
  
    {{ $.page.Scratch.Set "style_index" (gt $index 1) }}
  {{ end }}
  
  {{ if $.page.Scratch.Get "style_index" }}

    
    {{- if .id -}}
      {{- $.Scratch.Set "section_id" .id -}}
    {{- else -}}
      {{- $id := print "section-" $index -}}
      {{- $.Scratch.Set "section_id" $id -}}
    {{- end -}}
  

    {{- if and (in .template "select-part") (.part) -}}
      {{- if in .template "header-builder" -}}
        {{- $.Scratch.Set "section_tag" "header" -}}
      {{- else -}}
        {{- $.Scratch.Set "section_tag" "section" -}}
      {{- end -}}
      {{- $section_tag := $.Scratch.Get "section_tag" -}}
    
    


    {{ else }}

    
      {{- if in .template "header-builder" -}}
        {{- $.page.Scratch.Set "section_tag" "header" -}}
      {{- else -}}
        {{- $.page.Scratch.Set "section_tag" "section" -}}
      {{- end -}}

      {{- $section_tag := $.page.Scratch.Get "section_tag" -}}
      
        {{- partial "sections/style.html" (dict "page" . "global" $ ) | safeCSS -}}

        {{ $.page.Scratch.Set "is_critical" true }}



        
        {{- range .rows -}}
        {{ range .cols }}
        {{- range .elements -}}

        {{ if in .template "logo" }}
        {{- $.page.Scratch.Set "logo_base_css" true -}}
        {{- partial "elements/header/logo/style.html" (dict "page" . "global" $ "index" $index ) -}}
        {{ end }}

        {{ if in .template "menu" }}
        {{ $.page.Scratch.Set "menu_base_css" true }}
        {{- partial "elements/header/menu/style.html" (dict "page" . "global" $ "index" $index ) -}}
        
        {{ end }}

        {{ if in .template "button" }}
        {{ $.page.Scratch.Set "button_base_css" true }}
        {{- partial "elements/button/style.html" (dict "page" . "global" $ "index" $index ) -}}
        {{ end }}


        {{- if in .template "form" -}}
        {{- $.page.Scratch.Set "form_base_css" true -}}
        {{- partial "elements/form/style.html" (dict "page" . "global" $ "index" $index ) -}}
        {{- end -}}
        
        {{- if in .template "image" -}}
        {{- $.page.Scratch.Set "image_base_css" true -}}
        {{- partial "elements/image/style.html" (dict "page" . "global" $ "index" $index ) -}}
        {{- end -}}

        {{ end }}
        {{ end }}
        {{ end }}


    {{ end }}

    
  {{ end }}
   
  {{ end }}

{{ end }}

{{ end }}

{{ if eq ($.page.Scratch.Get "is_critical") true }}
{{- partial "sections/base.html" (dict "page" . "global" $ ) -}}
{{ end }}

{{ if (eq ( $.page.Scratch.Get "menu_base_css" ) true ) }}
{{- partial "elements/header/menu/base.html" (dict "page" . "global" $ ) -}}
{{ end }}

{{ if eq ( $.page.Scratch.Get "logo_base_css" ) true }}
{{- partial "elements/header/logo/base.html" (dict "page" . "global" $ ) -}}
{{ end }}

{{ if eq ( $.page.Scratch.Get "button_base_css" ) true }}
{{- partial "elements/button/base.html" (dict "page" . "global" $ ) -}}
{{ end }}

{{ if eq ( $.page.Scratch.Get "form_base_css" ) true }}
{{- partial "elements/form/base.html" (dict "page" . "global" $ ) -}}
{{ end }}

{{ if eq ( $.page.Scratch.Get "image_base_css" ) true }}
{{- partial "elements/image/base.html" (dict "page" . "global" $ ) -}}
{{ end }}

